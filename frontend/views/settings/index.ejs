<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações | Validade Inteligente</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/css/dashboard.css" rel="stylesheet">
    
    <style>
        .settings-section {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            color: #495057;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }
        
        .setting-item {
            padding: 1rem 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-weight: 500;
            color: #495057;
        }
        
        .setting-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .form-switch .form-check-input {
            width: 3rem;
            height: 1.5rem;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #e9ecef;
        }
        
        .avatar-upload {
            position: relative;
            display: inline-block;
        }
        
        .avatar-upload-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
        }
        
        @media (max-width: 768px) {
            .settings-section {
                padding: 1rem;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <%- include('../partials/header') %>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <%- include('../partials/sidebar') %>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Alerts -->
                <%- include('../partials/alerts') %>

                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mt-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/dashboard" class="text-decoration-none">
                                <i class="fas fa-home me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <i class="fas fa-cog me-1"></i>Configurações
                        </li>
                    </ol>
                </nav>

                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h3 mb-0">
                            <i class="fas fa-cog text-primary me-2"></i>
                            Configurações
                        </h1>
                        <p class="text-muted mb-0">Gerencie suas preferências e configurações do sistema</p>
                    </div>
                </div>

                <div class="row">
                    <!-- Left Column -->
                    <div class="col-lg-8">
                        <!-- Profile Settings -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-user text-primary me-2"></i>
                                Perfil do Usuário
                            </h5>
                            
                            <form id="profileForm">
                                <div class="row align-items-center mb-4">
                                    <div class="col-auto">
                                        <div class="avatar-upload">
                                            <img src="https://via.placeholder.com/120x120/007bff/ffffff?text=<%= user.name ? user.name.charAt(0).toUpperCase() : 'U' %>" 
                                                 alt="Avatar" class="profile-avatar" id="profileAvatar">
                                            <button type="button" class="avatar-upload-btn" onclick="document.getElementById('avatarInput').click()">
                                                <i class="fas fa-camera"></i>
                                            </button>
                                            <input type="file" id="avatarInput" class="d-none" accept="image/*">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <h6 class="mb-1"><%= user.name || 'Usuário' %></h6>
                                        <p class="text-muted mb-0"><%= user.email || 'usuario@exemplo.com' %></p>
                                        <small class="text-muted">Membro desde <%= new Date().getFullYear() %></small>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="userName" name="name" 
                                                   value="<%= user.name || '' %>" placeholder="Nome completo">
                                            <label for="userName">
                                                <i class="fas fa-user me-1"></i>Nome Completo
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="email" class="form-control" id="userEmail" name="email" 
                                                   value="<%= user.email || '' %>" placeholder="E-mail">
                                            <label for="userEmail">
                                                <i class="fas fa-envelope me-1"></i>E-mail
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="tel" class="form-control" id="userPhone" name="phone" 
                                                   value="" placeholder="Telefone">
                                            <label for="userPhone">
                                                <i class="fas fa-phone me-1"></i>Telefone
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="userCompany" name="company" 
                                                   value="" placeholder="Empresa">
                                            <label for="userCompany">
                                                <i class="fas fa-building me-1"></i>Empresa
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Salvar Perfil
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Security Settings -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-shield-alt text-primary me-2"></i>
                                Segurança
                            </h5>
                            
                            <form id="securityForm">
                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Alterar Senha</div>
                                            <div class="setting-description">
                                                Atualize sua senha para manter sua conta segura
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                                                <i class="fas fa-key me-1"></i>Alterar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Autenticação de Dois Fatores</div>
                                            <div class="setting-description">
                                                Adicione uma camada extra de segurança à sua conta
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="twoFactorAuth">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Sessões Ativas</div>
                                            <div class="setting-description">
                                                Gerencie dispositivos conectados à sua conta
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <button type="button" class="btn btn-outline-secondary">
                                                <i class="fas fa-devices me-1"></i>Gerenciar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- Notification Settings -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-bell text-primary me-2"></i>
                                Notificações
                            </h5>
                            
                            <form id="notificationForm">
                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Alertas de Vencimento</div>
                                            <div class="setting-description">
                                                Receba notificações quando produtos estiverem próximos ao vencimento
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="expiryAlerts" checked>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Relatórios por E-mail</div>
                                            <div class="setting-description">
                                                Receba relatórios semanais sobre o status do estoque
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="emailReports" checked>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Notificações Push</div>
                                            <div class="setting-description">
                                                Receba notificações em tempo real no navegador
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="pushNotifications">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Dias de Antecedência</div>
                                            <div class="setting-description">
                                                Quantos dias antes do vencimento você quer ser notificado
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <select class="form-select" id="notificationDays" style="width: auto;">
                                                <option value="7">7 dias</option>
                                                <option value="15" selected>15 dias</option>
                                                <option value="30">30 dias</option>
                                                <option value="60">60 dias</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Salvar Notificações
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- System Settings -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-cogs text-primary me-2"></i>
                                Sistema
                            </h5>
                            
                            <form id="systemForm">
                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Tema</div>
                                            <div class="setting-description">
                                                Escolha entre tema claro ou escuro
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <select class="form-select" id="themeSelect" style="width: auto;">
                                                <option value="light" selected>Claro</option>
                                                <option value="dark">Escuro</option>
                                                <option value="auto">Automático</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Idioma</div>
                                            <div class="setting-description">
                                                Selecione o idioma da interface
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <select class="form-select" id="languageSelect" style="width: auto;">
                                                <option value="pt-BR" selected>Português (Brasil)</option>
                                                <option value="en-US">English (US)</option>
                                                <option value="es-ES">Español</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <div class="setting-label">Backup Automático</div>
                                            <div class="setting-description">
                                                Faça backup automático dos dados do sistema
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="autoBackup" checked>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Salvar Sistema
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="col-lg-4">
                        <!-- Account Stats -->
                        <div class="stats-card mb-4">
                            <div class="stats-number">
                                <i class="fas fa-calendar-check"></i>
                                <%= new Date().getDate() %>
                            </div>
                            <div>Dias usando o sistema</div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-bolt text-primary me-2"></i>
                                Ações Rápidas
                            </h5>
                            
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-primary" onclick="exportData()">
                                    <i class="fas fa-download me-2"></i>Exportar Dados
                                </button>
                                <button type="button" class="btn btn-outline-info" onclick="importData()">
                                    <i class="fas fa-upload me-2"></i>Importar Dados
                                </button>
                                <button type="button" class="btn btn-outline-warning" onclick="clearCache()">
                                    <i class="fas fa-broom me-2"></i>Limpar Cache
                                </button>
                                <button type="button" class="btn btn-outline-danger" onclick="confirmAccountDeletion()">
                                    <i class="fas fa-user-times me-2"></i>Excluir Conta
                                </button>
                            </div>
                        </div>

                        <!-- Support -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-life-ring text-primary me-2"></i>
                                Suporte
                            </h5>
                            
                            <div class="d-grid gap-2">
                                <a href="#" class="btn btn-outline-secondary">
                                    <i class="fas fa-question-circle me-2"></i>Central de Ajuda
                                </a>
                                <a href="#" class="btn btn-outline-secondary">
                                    <i class="fas fa-envelope me-2"></i>Contatar Suporte
                                </a>
                                <a href="#" class="btn btn-outline-secondary">
                                    <i class="fas fa-bug me-2"></i>Reportar Bug
                                </a>
                            </div>
                        </div>

                        <!-- System Info -->
                        <div class="settings-section">
                            <h5 class="section-title">
                                <i class="fas fa-info-circle text-primary me-2"></i>
                                Informações do Sistema
                            </h5>
                            
                            <div class="small text-muted">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Versão:</span>
                                    <span>1.0.0</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Última Atualização:</span>
                                    <span><%= new Date().toLocaleDateString('pt-BR') %></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Status:</span>
                                    <span class="text-success">
                                        <i class="fas fa-circle me-1"></i>Online
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">
                        <i class="fas fa-key text-primary me-2"></i>
                        Alterar Senha
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="currentPassword" placeholder="Senha atual" required>
                            <label for="currentPassword">Senha Atual</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="newPassword" placeholder="Nova senha" required>
                            <label for="newPassword">Nova Senha</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirmar nova senha" required>
                            <label for="confirmPassword">Confirmar Nova Senha</label>
                        </div>
                        <div class="password-strength mb-3">
                            <div class="progress" style="height: 5px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted">Força da senha</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="changePassword()">
                        <i class="fas fa-save me-2"></i>Alterar Senha
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Form submissions
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showAlert('Perfil atualizado com sucesso!', 'success');
        });

        document.getElementById('notificationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showAlert('Configurações de notificação salvas!', 'success');
        });

        document.getElementById('systemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showAlert('Configurações do sistema salvas!', 'success');
        });

        // Quick actions
        function exportData() {
            showAlert('Exportação iniciada! Você receberá um e-mail quando estiver pronta.', 'info');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv';
            input.onchange = function() {
                showAlert('Importação iniciada! Os dados serão processados em breve.', 'info');
            };
            input.click();
        }

        function clearCache() {
            if (confirm('Tem certeza que deseja limpar o cache? Isso pode afetar a performance temporariamente.')) {
                showAlert('Cache limpo com sucesso!', 'success');
            }
        }

        function confirmAccountDeletion() {
            if (confirm('ATENÇÃO: Esta ação é irreversível! Tem certeza que deseja excluir sua conta?')) {
                showAlert('Solicitação de exclusão enviada. Você receberá um e-mail de confirmação.', 'warning');
            }
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showAlert('Por favor, preencha todos os campos.', 'warning');
                return;
            }

            if (newPassword !== confirmPassword) {
                showAlert('As senhas não coincidem.', 'danger');
                return;
            }

            if (newPassword.length < 8) {
                showAlert('A nova senha deve ter pelo menos 8 caracteres.', 'warning');
                return;
            }

            // Simulate password change
            const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
            modal.hide();
            showAlert('Senha alterada com sucesso!', 'success');
            
            // Clear form
            document.getElementById('changePasswordForm').reset();
        }

        // Password strength indicator
        document.getElementById('newPassword').addEventListener('input', function() {
            const password = this.value;
            const progressBar = document.querySelector('.password-strength .progress-bar');
            
            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            progressBar.style.width = strength + '%';
            progressBar.className = 'progress-bar ' + 
                (strength < 50 ? 'bg-danger' : strength < 75 ? 'bg-warning' : 'bg-success');
        });

        // Avatar upload
        document.getElementById('avatarInput').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileAvatar').src = e.target.result;
                };
                reader.readAsDataURL(file);
                showAlert('Avatar atualizado!', 'success');
            }
        });

        // Theme change
        document.getElementById('themeSelect').addEventListener('change', function() {
            const theme = this.value;
            // Apply theme logic here
            showAlert(`Tema alterado para: ${theme}`, 'info');
        });

        // Utility function for alerts
        function showAlert(message, type) {
            const alertContainer = document.querySelector('.container-fluid .row main');
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.insertAdjacentHTML('afterbegin', alertHtml);
            
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', function() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>